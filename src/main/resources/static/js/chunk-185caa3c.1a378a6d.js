(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-185caa3c"],{"3c86":function(e,t,a){"use strict";var n=a("55d3"),r=a.n(n);r.a},"55d3":function(e,t,a){},"64a0":function(e,t,a){"use strict";a.d(t,"a",(function(){return getDictionary}));var n=a("dbe5"),r="/api/fore/dict/selectByType";function getDictionary(e){return Object(n["a"])({method:"GET",url:r,params:{type:e}})}},"7db0":function(e,t,a){"use strict";var n=a("23e7"),r=a("b727").find,o=a("44d2"),i=a("ae40"),s="find",c=!0,l=i(s);s in[]&&Array(1)[s]((function(){c=!1})),n({target:"Array",proto:!0,forced:c||!l},{find:function find(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),o(s)},"857a":function(e,t,a){var n=a("1d80"),r=/"/g;e.exports=function(e,t,a,o){var i=String(n(e)),s="<"+t;return""!==a&&(s+=" "+a+'="'+String(o).replace(r,"&quot;")+'"'),s+">"+i+"</"+t+">"}},9911:function(e,t,a){"use strict";var n=a("23e7"),r=a("857a"),o=a("af03");n({target:"String",proto:!0,forced:o("link")},{link:function link(e){return r(this,"a","href",e)}})},a18d:function(e,t,a){"use strict";a.r(t);var render=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"entry-page"},[a("top",{attrs:{height:"1.63rem",topBgImage:e.topBgImage,styler:{fontSize:"0.46rem",color:"#ffffff",paddingTop:"0.32rem",textAlign:"center"}}}),a("div",{staticClass:"user-info"},[a("van-form",{attrs:{"show-error-message":!1,"label-width":"80px"},on:{submit:e.onSubmit}},[a("van-field",{attrs:{label:"姓名",name:"name",placeholder:"请填写姓名",rules:[{required:!0,message:"请填写姓名"}]},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),a("van-field",{attrs:{label:"民族",name:"nation",placeholder:"请填写民族"},model:{value:e.form.nation,callback:function(t){e.$set(e.form,"nation",t)},expression:"form.nation"}}),a("van-field",{attrs:{readonly:"",clickable:"",label:"出生年月",name:"age",placeholder:"请选择出年月",rules:[{required:!0,message:"请选择出年月"}]},on:{click:function(t){e.showDatePicker=!0}},model:{value:e.form.age,callback:function(t){e.$set(e.form,"age",t)},expression:"form.age"}}),a("van-field",{attrs:{label:"就读学校",name:"school",placeholder:"请填写就读学校"},model:{value:e.form.school,callback:function(t){e.$set(e.form,"school",t)},expression:"form.school"}}),a("van-field",{attrs:{label:"头像"},scopedSlots:e._u([{key:"input",fn:function(){return[a("van-uploader",{attrs:{name:"file","max-count":"1",accept:"image/*","before-read":e.beforeImageRead,"after-read":e.afterImageRead},on:{delete:e.handleDeleteImage},model:{value:e.imageFileList,callback:function(t){e.imageFileList=t},expression:"imageFileList"}}),a("van-field",{attrs:{type:"hidden",name:"image"},model:{value:e.form.image,callback:function(t){e.$set(e.form,"image",t)},expression:"form.image"}})]},proxy:!0}])}),a("van-field",{attrs:{label:"作品名称",name:"title",placeholder:"请填写作品名称",rules:[{required:!0,message:"请填写作品名称"}]},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}}),a("van-field",{attrs:{readonly:"",clickable:"",label:"类型",name:"selectType1",placeholder:"请选择类型",rules:[{required:!0,message:"请选择类型"}]},on:{click:function(t){e.showTypePicker=!0}},model:{value:e.form.selectType1,callback:function(t){e.$set(e.form,"selectType1",t)},expression:"form.selectType1"}}),a("van-field",{attrs:{readonly:"",disabled:"",label:"组别",name:"selectType2",placeholder:"自动填入",rules:[{required:!0}]},model:{value:e.form.selectType2,callback:function(t){e.$set(e.form,"selectType2",t)},expression:"form.selectType2"}}),a("van-field",{attrs:{label:"视频"},scopedSlots:e._u([{key:"input",fn:function(){return[a("div",{staticClass:"custom-upload"},[a("div",{staticClass:"custom-upload-container flex-center-center"},[a("van-uploader",{attrs:{name:"file",accept:"video/*","max-count":"1","before-read":e.beforeVideoRead,"after-read":e.afterVideoRead}},[a("van-button",{staticStyle:{width:"1.6rem"},attrs:{type:"info",size:"small"}},[e._v("上传")])],1),a("van-field",{attrs:{disabled:"",name:"video",placeholder:"请上传视频",rules:[{required:!0,message:"请上传视频"}]},model:{value:e.form.video,callback:function(t){e.$set(e.form,"video",t)},expression:"form.video"}})],1),e.showProgress?a("div",{staticClass:"custom-upload-preview"},[e.showProgress?a("van-progress",{attrs:{percentage:e.videoProgress,"show-pivot":!1,"stroke-width":"5"}}):e._e(),a("van-icon",{attrs:{name:"close",size:"20"},on:{click:e.handleDeleteVideo}})],1):e._e()])]},proxy:!0}])}),a("van-field",{staticClass:"detail",attrs:{label:"正文"},scopedSlots:e._u([{key:"input",fn:function(){return[a("van-field",{staticStyle:{height:"0"},attrs:{disabled:"",name:"content"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})]},proxy:!0}])}),a("div",{staticClass:"not_rem_eleditor"},[a("div",{attrs:{id:"eleditor"}})]),a("van-button",{staticStyle:{width:"90%",margin:"0 auto"},attrs:{round:"",block:"",type:"info","native-type":"submit",loading:e.submitLoading,"loading-text":"正在提交"}},[e._v(" 提交 ")])],1)],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showDatePicker,callback:function(t){e.showDatePicker=t},expression:"showDatePicker"}},[a("van-datetime-picker",{attrs:{type:"year-month","min-date":e.minDate,"max-date":e.maxData,title:"请选择出年月"},on:{cancel:function(t){e.showDatePicker=!1},confirm:e.handleConfirmDatePicker},model:{value:e.currentData,callback:function(t){e.currentData=t},expression:"currentData"}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showTypePicker,callback:function(t){e.showTypePicker=t},expression:"showTypePicker"}},[a("van-picker",{attrs:{"show-toolbar":"",columns:e.typeColumns,title:"选择类型"},on:{cancel:function(t){e.showTypePicker=!1},confirm:e.handleConfirmTypePicker}})],1)],1)},n=[],r=(a("99af"),a("7db0"),a("d81d"),a("b0c0"),a("a9e3"),a("9911"),a("96cf"),a("1da1")),o=a("d4ec"),i=a("bee2"),s=a("262e"),c=a("2caf"),l=a("9ab4"),u=a("60a3"),d=a("9df3"),f=a("c004"),m=a.n(f),p=a("73ec"),h=a("93f3"),v=a("4bb5"),g=a("67bd"),b=a("ea9b"),y=a("64a0"),k=a("dbe5");function uploadBase(e,t,a){return Object(k["a"])({url:e,method:"POST",data:t,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a})}function uploadImage(e,t){return uploadBase("/api/upload/uploadImage",e,t)}var w=a("bc3a"),x=a.n(w),T=a("7122"),P=Object(v["b"])("user"),D=function(e){Object(s["a"])(ActiveEntry,e);var t=Object(c["a"])(ActiveEntry);function ActiveEntry(){var e;return Object(o["a"])(this,ActiveEntry),e=t.apply(this,arguments),e.topBgImage=m.a,e.form={name:"",nation:"",age:"",school:"",image:"",title:"",selectType1:"",selectType2:"",video:"",content:""},e.showDatePicker=!1,e.minDate=new Date(1900,0),e.maxData=new Date,e.currentData=new Date,e.imageFileList=[],e.showTypePicker=!1,e.typeColumns=[],e.videoProgress=0,e.showProgress=!1,e.editor=null,e.submitLoading=!1,e.cancel=null,e}return Object(i["a"])(ActiveEntry,[{key:"handleConfirmDatePicker",value:function handleConfirmDatePicker(e){this.form.age=Object(p["a"])(e,"YYYY-MM");var t=Object(p["c"])(this.form.age);this.form.selectType2=t?h["b"].find((function(e){return e.value===t})).name:"",this.showDatePicker=!1}},{key:"handleConfirmTypePicker",value:function handleConfirmTypePicker(e){this.form.selectType1=e.text,this.showTypePicker=!1}},{key:"initEleditor",value:function initEleditor(){this.editor=new Eleditor({el:"#eleditor",upload:{server:"".concat("","/api/upload/uploadEleditor"),fileSizeLimit:10,formName:"file",accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/gif,image/jpg,image/jpeg,image/bmp,image/png"}},toolbars:["insertText","editText","insertImage","insertHr","delete","cancel"],placeHolder:"点击编辑正文..."})}},{key:"beforeImageRead",value:function beforeImageRead(e){var t=e.type;return!!/^image\//.test(t)||(this.$toast.fail({message:"请上传图片",duration:1e3,forbidClick:!0}),!1)}},{key:"afterImageRead",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function _callee(e){var t,a;return regeneratorRuntime.wrap((function _callee$(n){while(1)switch(n.prev=n.next){case 0:return e.status="uploading",e.message="上传中",n.prev=2,t=new FormData,t.append("file",e.file),n.next=7,uploadImage(t);case 7:a=n.sent,200===a.status?(e.status="done",e.message="上传成功",e.url=a.link,this.form.image=a.link,this.$toast.fail({message:"上传成功"})):(e.status="failed",e.message="上传失败",this.$toast.fail({message:"上传失败"})),n.next=16;break;case 11:n.prev=11,n.t0=n["catch"](2),e.status="failed",e.message="上传失败",this.$toast.fail({message:"上传失败"});case 16:case"end":return n.stop()}}),_callee,this,[[2,11]])})));function afterImageRead(t){return e.apply(this,arguments)}return afterImageRead}()},{key:"handleDeleteImage",value:function handleDeleteImage(){this.form.image=""}},{key:"beforeVideoRead",value:function beforeVideoRead(e){var t=e.type;return!!/^video\//.test(t)||(this.$toast.fail({message:"请上传视频",duration:1e3,forbidClick:!0}),!1)}},{key:"afterVideoRead",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function _callee2(e){var t,a,n=this;return regeneratorRuntime.wrap((function _callee2$(r){while(1)switch(r.prev=r.next){case 0:this.showProgress=!0,t=this,a=new FormData,a.append("file",e.file),x()({url:"/api/upload/uploadVideo",method:"POST",data:a,headers:{"Content-Type":"multipart/form-data"},cancelToken:new x.a.CancelToken((function executor(e){t.cancel=e})),onUploadProgress:function onUploadProgress(e){var t=e.loaded,a=e.total;n.videoProgress=Math.floor(t/a*100)}}).then((function(t){200===t.data.status?(n.form.video=t.data.link,n.$toast.fail({message:"上传成功"})):(e.status="failed",e.message="上传失败",n.$toast.fail({message:"上传失败"}))})).catch((function(e){n.$toast.fail({message:"上传失败"})}));case 5:case"end":return r.stop()}}),_callee2,this)})));function afterVideoRead(t){return e.apply(this,arguments)}return afterVideoRead}()},{key:"handleDeleteVideo",value:function handleDeleteVideo(){this.cancel&&this.cancel(),this.showProgress=!1,this.videoProgress=0,this.form.video=""}},{key:"onSubmit",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function _callee3(){var e,t,a,n,r,o,i,s,c,l,u,d,f,m,p,v=this;return regeneratorRuntime.wrap((function _callee3$(g){while(1)switch(g.prev=g.next){case 0:return this.$toast.loading({message:"正在提交",forbidClick:!0,duration:0}),g.prev=1,g.next=4,Object(b["a"])(this.user.openid);case 4:e=!0,g.next=10;break;case 7:g.prev=7,g.t0=g["catch"](1),e=!1;case 10:if(e){g.next=13;break}return this.$toast("请先关注景德镇市文化馆微信公众号"),g.abrupt("return",!1);case 13:return t=this.form,a=t.age,n=t.image,r=t.name,o=t.nation,i=t.school,s=t.video,c=t.selectType1,l=t.selectType2,u=t.title,d=this.editor.getContent(),f=Number(this.$route.params.id),m=this.typeColumns.find((function(e){return e.text===c})).value,p=h["b"].find((function(e){return e.name===l})).value,g.prev=18,g.next=21,Object(T["a"])(a,n,r,o,this.user.openid,i);case 21:return g.next=23,Object(T["b"])(f,0,r,d,u,m,p,s,this.user.id);case 23:this.$toast.success({message:"提交成功,等待管理员审核",forbidClick:!0,onClose:function onClose(){return v.$router.back()}}),g.next=29;break;case 26:g.prev=26,g.t1=g["catch"](18),this.$toast.fail("提交失败");case 29:case"end":return g.stop()}}),_callee3,this,[[1,7],[18,26]])})));function onSubmit(){return e.apply(this,arguments)}return onSubmit}()},{key:"created",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function _callee4(){var e,t,a,n;return regeneratorRuntime.wrap((function _callee4$(r){while(1)switch(r.prev=r.next){case 0:if(e=Object(g["a"])("code"),!e){r.next=12;break}return r.prev=2,r.next=5,Object(b["b"])(e);case 5:t=r.sent,this.setUserInfo(t.data),r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](2),console.log(r.t0);case 12:return this.user||(a=window.location.href,window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=".concat(h["a"],"&redirect_uri=").concat(a,"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")),r.prev=13,r.next=16,Object(y["a"])(1);case 16:n=r.sent,this.typeColumns=n.data.map((function(e){return{text:e.name,value:e.id}})),r.next=23;break;case 20:r.prev=20,r.t1=r["catch"](13),console.log(r.t1);case 23:case"end":return r.stop()}}),_callee4,this,[[2,9],[13,20]])})));function created(){return e.apply(this,arguments)}return created}()},{key:"mounted",value:function mounted(){this.initEleditor()}}]),ActiveEntry}(u["c"]);Object(l["a"])([P.Action("SET_USER_INFO")],D.prototype,"setUserInfo",void 0),Object(l["a"])([Object(v["a"])("user")],D.prototype,"user",void 0),D=Object(l["a"])([Object(u["a"])({components:{Top:d["a"]}})],D);var j=D,$=j,_=(a("3c86"),a("2877")),C=Object(_["a"])($,render,n,!1,null,"f72fa7ec",null);t["default"]=C.exports},af03:function(e,t,a){var n=a("d039");e.exports=function(e){return n((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},d81d:function(e,t,a){"use strict";var n=a("23e7"),r=a("b727").map,o=a("1dde"),i=a("ae40"),s=o("map"),c=i("map");n({target:"Array",proto:!0,forced:!s||!c},{map:function map(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);